{
  "resolvedId": "D:/hub2023A/itwinjs-core/test-apps/display-test-app/src/frontend/Viewer.ts",
  "transforms": [
    {
      "name": "vite:load-fallback",
      "result": "/*---------------------------------------------------------------------------------------------\r\n* Copyright (c) Bentley Systems, Incorporated. All rights reserved.\r\n* See LICENSE.md in the project root for license terms and full copyright notice.\r\n*--------------------------------------------------------------------------------------------*/\r\nimport { Id64String } from \"@itwin/core-bentley\";\r\nimport { ClipPlane, ClipPrimitive, ClipVector, ConvexClipPlaneSet, Vector3d } from \"@itwin/core-geometry\";\r\nimport { ModelClipGroup, ModelClipGroups } from \"@itwin/core-common\";\r\nimport {\r\n  IModelApp, IModelConnection, MarginOptions, MarginPercent, NotifyMessageDetails, openImageDataUrlInNewWindow, OutputMessagePriority,\r\n  PaddingPercent, ScreenViewport, Tool, Viewport, ViewState,\r\n} from \"@itwin/core-frontend\";\r\nimport { parseArgs } from \"@itwin/frontend-devtools\";\r\nimport { MarkupApp, MarkupData } from \"@itwin/core-markup\";\r\nimport { ClassificationsPanel } from \"./ClassificationsPanel\";\r\nimport { DebugWindow } from \"./DebugWindow\";\r\nimport { FeatureOverridesPanel } from \"./FeatureOverrides\";\r\nimport { CategoryPicker, ModelPicker } from \"./IdPicker\";\r\nimport { SavedViewPicker } from \"./SavedViews\";\r\nimport { CameraPathsMenu } from \"./CameraPaths\";\r\nimport { SectionsPanel } from \"./SectionTools\";\r\nimport { StandardRotations } from \"./StandardRotations\";\r\nimport { Surface } from \"./Surface\";\r\nimport { createTimeline } from \"./Timeline\";\r\nimport { setTitle } from \"./Title\";\r\nimport { createImageButton, createToolButton, ToolBar } from \"./ToolBar\";\r\nimport { ViewAttributesPanel } from \"./ViewAttributes\";\r\nimport { ViewList, ViewPicker } from \"./ViewPicker\";\r\nimport { Window } from \"./Window\";\r\nimport { openIModel, OpenIModelProps } from \"./openIModel\";\r\nimport { HubPicker } from \"./HubPicker\";\r\nimport { RealityModelSettingsPanel } from \"./RealityModelDisplaySettingsWidget\";\r\n\r\n// cspell:ignore savedata topdiv savedview viewtop\r\n\r\nasync function zoomToSelectedElements(vp: Viewport, options?: MarginOptions) {\r\n  const elems = vp.iModel.selectionSet.elements;\r\n  if (0 < elems.size)\r\n    await vp.zoomToElements(elems, { animateFrustumChange: true, ...options });\r\n}\r\n\r\nexport class ZoomToSelectedElementsTool extends Tool {\r\n  private _margin?: MarginPercent;\r\n  private _padding?: PaddingPercent | number;\r\n\r\n  public static override toolId = \"ZoomToSelectedElements\";\r\n  public static override get maxArgs() { return 4; }\r\n\r\n  public override async run(): Promise<boolean> {\r\n    const vp = IModelApp.viewManager.selectedView;\r\n    if (undefined !== vp) {\r\n      await zoomToSelectedElements(vp, {\r\n        marginPercent: this._margin,\r\n        paddingPercent: this._padding,\r\n      });\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public override async parseAndRun(...input: string[]): Promise<boolean> {\r\n    const args = parseArgs(input);\r\n    const padding = args.getFloat(\"p\");\r\n    if (undefined !== padding) {\r\n      if (args.getBoolean(\"m\"))\r\n        this._margin = { left: padding, right: padding, top: padding, bottom: padding };\r\n      else\r\n        this._padding = padding;\r\n    } else {\r\n      const left = args.getFloat(\"l\") ?? 0;\r\n      const right = args.getFloat(\"r\") ?? 0;\r\n      const top = args.getFloat(\"t\") ?? 0;\r\n      const bottom = args.getFloat(\"b\") ?? 0;\r\n      if (undefined !== left || undefined !== right || undefined !== top || undefined !== bottom) {\r\n        if (args.getBoolean(\"m\"))\r\n          this._margin = { left, right, top, bottom };\r\n        else\r\n          this._padding = { left, right, top, bottom };\r\n      }\r\n    }\r\n\r\n    return this.run();\r\n  }\r\n}\r\n\r\nexport class ModelClipTool extends Tool {\r\n  public static override toolId = \"ModelClip\";\r\n  public override async run(_args: any[]): Promise<boolean> {\r\n    const view = IModelApp.viewManager.selectedView?.view;\r\n    if (!view || !view.isSpatialView() || view.modelSelector.models.size < 2)\r\n      return true;\r\n\r\n    const createClip = (vector: Vector3d) => {\r\n      const plane = ClipPlane.createNormalAndPoint(vector, view.iModel.projectExtents.center)!;\r\n      const planes = ConvexClipPlaneSet.createPlanes([plane]);\r\n      const primitive = ClipPrimitive.createCapture(planes);\r\n      return ClipVector.createCapture([primitive]);\r\n    };\r\n\r\n    const leftModels: string[] = [];\r\n    const rightModels: string[] = [];\r\n    let left = true;\r\n    view.modelSelector.models.forEach((model) => {\r\n      (left ? leftModels : rightModels).push(model);\r\n      left = !left;\r\n    });\r\n\r\n    view.details.modelClipGroups = new ModelClipGroups([\r\n      ModelClipGroup.create(createClip(Vector3d.unitX().negate()), rightModels),\r\n      ModelClipGroup.create(createClip(Vector3d.unitZ().negate()), leftModels),\r\n    ]);\r\n\r\n    IModelApp.viewManager.selectedView!.invalidateScene();\r\n    return true;\r\n  }\r\n}\r\n\r\nexport class MarkupTool extends Tool {\r\n  public static override toolId = \"Markup\";\r\n  public static savedData?: MarkupData;\r\n  public static override get minArgs() { return 0; }\r\n  public static override get maxArgs() { return 1; }\r\n\r\n  public override async run(wantSavedData: boolean): Promise<boolean> {\r\n    const vp = IModelApp.viewManager.selectedView;\r\n    if (undefined === vp)\r\n      return true;\r\n\r\n    if (MarkupApp.isActive) {\r\n      // NOTE: Because we don't have separate START and STOP buttons in the test app, exit markup mode only when the Markup Select tool is active, otherwise start the Markup Select tool...\r\n      const startMarkupSelect = IModelApp.toolAdmin.defaultToolId === MarkupApp.markupSelectToolId && (undefined === IModelApp.toolAdmin.activeTool || MarkupApp.markupSelectToolId !== IModelApp.toolAdmin.activeTool.toolId);\r\n      if (startMarkupSelect) {\r\n        await IModelApp.toolAdmin.startDefaultTool();\r\n        return true;\r\n      }\r\n      MarkupApp.props.result.maxWidth = 1500;\r\n      MarkupApp.stop().then((markupData) => {\r\n        if (wantSavedData)\r\n          MarkupTool.savedData = markupData;\r\n        if (undefined !== markupData.image)\r\n          openImageDataUrlInNewWindow(markupData.image, \"Markup\");\r\n      }).catch((_) => { });\r\n    } else {\r\n      MarkupApp.props.active.element.stroke = \"white\"; // as an example, set default color for elements\r\n      MarkupApp.markupSelectToolId = \"Markup.TestSelect\"; // as an example override the default markup select tool to launch redline tools using key events\r\n      await MarkupApp.start(vp, wantSavedData ? MarkupTool.savedData : undefined);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public override async parseAndRun(...args: string[]): Promise<boolean> {\r\n    const wantSavedData = \"savedata\" === args[0]?.toLowerCase();\r\n    return this.run(wantSavedData);\r\n  }\r\n}\r\n\r\nexport interface ViewerProps {\r\n  iModel: IModelConnection;\r\n  defaultViewName?: string;\r\n  disableEdges?: boolean;\r\n}\r\n\r\nexport class Viewer extends Window {\r\n  public readonly views: ViewList;\r\n  public readonly viewport: ScreenViewport;\r\n  public readonly toolBar: ToolBar;\r\n  public readonly disableEdges: boolean;\r\n  private _imodel: IModelConnection;\r\n  private readonly _viewPicker: ViewPicker;\r\n  private readonly _3dOnly: HTMLElement[] = [];\r\n  private _isSavedView = false;\r\n  private _debugWindow?: DebugWindow;\r\n\r\n  public static async create(surface: Surface, props: ViewerProps): Promise<Viewer> {\r\n    const views = await ViewList.create(props.iModel, props.defaultViewName);\r\n    const view = await views.getDefaultView(props.iModel);\r\n    const viewer = new Viewer(surface, view, views, props);\r\n    return viewer;\r\n  }\r\n\r\n  public clone(): Viewer {\r\n    const view = this.viewport.view.clone();\r\n    const viewer = new Viewer(Surface.instance, view, this.views, {\r\n      iModel: view.iModel,\r\n      disableEdges: this.disableEdges,\r\n    });\r\n\r\n    if (!this.isDocked) {\r\n      // Match dimensions\r\n      viewer.container.style.width = this.container.style.width;\r\n      viewer.container.style.height = this.container.style.height;\r\n\r\n      // Offset position from top-left corner\r\n      const style = getComputedStyle(this.container, null);\r\n      const pxToNum = (propName: string) => parseFloat(style.getPropertyValue(propName).replace(\"px\", \"\")) + 40;\r\n      viewer.container.style.top = `${pxToNum(\"top\")}px`;\r\n      viewer.container.style.left = `${pxToNum(\"left\")}px`;\r\n    }\r\n\r\n    return viewer;\r\n  }\r\n\r\n  private _maybeDisableEdges() {\r\n    if (this.disableEdges && (this.viewport.viewFlags.visibleEdges || this.viewport.viewFlags.hiddenEdges)) {\r\n      this.viewport.viewFlags = this.viewport.viewFlags.copy({ visibleEdges: false, hiddenEdges: false });\r\n    }\r\n  }\r\n\r\n  private constructor(surface: Surface, view: ViewState, views: ViewList, props: ViewerProps) {\r\n    super(surface, { scrollbars: true });\r\n\r\n    // Allow HTMLElements beneath viewport to be visible if background color has transparency.\r\n    this.contentDiv.style.backgroundColor = \"transparent\";\r\n    this.container.style.backgroundColor = \"transparent\";\r\n    surface.element.appendChild(this.container);\r\n\r\n    this.disableEdges = true === props.disableEdges;\r\n    this._imodel = props.iModel;\r\n    this.viewport = ScreenViewport.create(this.contentDiv, view);\r\n    this.views = views;\r\n\r\n    this._maybeDisableEdges();\r\n\r\n    this.toolBar = new ToolBar(IModelApp.makeHTMLElement(\"div\", { className: \"topdiv\" }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue90c\", // properties\r\n      tooltip: \"Debug info\",\r\n      click: () => this.toggleDebugWindow(),\r\n    }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue9cc\",\r\n      tooltip: \"Open iModel from disk\",\r\n      click: async () => {\r\n        await this.selectIModel();\r\n      },\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue9e0\", // cloud-download\r\n      tooltip: \"Open iModel from hub\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new HubPicker(container, async (iModelId, iTwinId) => {\r\n          alert(`About to download and open hub iModel. Note that this could take quite some time without any feedback.`);\r\n          await this.openIModel({\r\n            iModelId,\r\n            iTwinId,\r\n            writable: this.surface.openReadWrite,\r\n          });\r\n          picker.close();\r\n        });\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this._viewPicker = new ViewPicker(this.toolBar.element, this.views);\r\n    this._viewPicker.onSelectedViewChanged.addListener(async (id) => this.changeView(id));\r\n    this._viewPicker.element.addEventListener(\"click\", () => this.toolBar.close());\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90b\", // \"model\"\r\n      tooltip: \"Models\",\r\n      only3d: true,\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new ModelPicker(this.viewport, container);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue901\", // \"categories\"\r\n      tooltip: \"Categories\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new CategoryPicker(this.viewport, container);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90d\", // \"savedview\"\r\n      tooltip: \"External saved views\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new SavedViewPicker(this.viewport, container, this);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue932\",\r\n      tooltip: \"Saved camera paths\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new CameraPathsMenu(this.viewport, container);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"zoom.svg\",\r\n      click: async () => IModelApp.tools.run(\"SVTSelect\"),\r\n      tooltip: \"Element selection\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ueb08\",\r\n      click: async () => IModelApp.tools.run(\"Measure.Distance\", IModelApp.viewManager.selectedView!),\r\n      tooltip: \"Measure distance\",\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90e\",\r\n      tooltip: \"View settings\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const panel = new ViewAttributesPanel(this.viewport, container, this.disableEdges);\r\n        await panel.populate();\r\n        return panel;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"fit-to-view.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.Fit\", this.viewport, true),\r\n      tooltip: \"Fit view\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"window-area.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.WindowArea\", this.viewport),\r\n      tooltip: \"Window area\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"rotate-left.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.Rotate\", this.viewport),\r\n      tooltip: \"Rotate\",\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue909\", // \"gyroscope\"\r\n      createDropDown: async (container: HTMLElement) => new StandardRotations(container, this.viewport),\r\n      tooltip: \"Standard rotations\",\r\n      only3d: true,\r\n    });\r\n\r\n    const walk = createImageButton({\r\n      src: \"walk.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.LookAndMove\", this.viewport),\r\n      tooltip: \"Walk\",\r\n    });\r\n    this._3dOnly.push(walk);\r\n    this.toolBar.addItem(walk);\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue982\", // \"undo\"\r\n      click: async () => IModelApp.tools.run(\"View.Undo\", this.viewport),\r\n      tooltip: \"View undo\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue983\", // \"redo\"\r\n      click: async () => IModelApp.tools.run(\"View.Redo\", this.viewport),\r\n      tooltip: \"View redo\",\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue931\", // \"animation\"\r\n      createDropDown: async (container: HTMLElement) => createTimeline(this.viewport, container, 10),\r\n      tooltip: \"Animation / solar time\",\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue916\", // \"viewtop\"\r\n      tooltip: \"Sectioning tools\",\r\n      createDropDown: async (container: HTMLElement) => new SectionsPanel(this.viewport, container),\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue9d8\", // \"property-data\"\r\n      tooltip: \"Spatial Classification\",\r\n      only3d: true,\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const panel = new ClassificationsPanel(this.viewport, container);\r\n        await panel.populate();\r\n        return panel;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90a\", // \"isolate\"\r\n      createDropDown: async (container: HTMLElement) => new FeatureOverridesPanel(this.viewport, container),\r\n      tooltip: \"Override feature symbology\",\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue923\", // \"pencil\"  ###TODO where to get real icon?\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const panel = new RealityModelSettingsPanel(this.viewport, container);\r\n        await panel.populate();\r\n        return panel;\r\n      },\r\n      tooltip: \"Point cloud settings\",\r\n    });\r\n\r\n    this.updateTitle();\r\n    this.updateActiveSettings();\r\n  }\r\n\r\n  private updateTitle(): void {\r\n    let viewName = this.viewport.view.code.value;\r\n    if (undefined === viewName || 0 === viewName.length)\r\n      viewName = \"UNNAMED\";\r\n\r\n    const id = !this._isSavedView ? this.viewport.view.id : \"Saved View\";\r\n    const dim = this.viewport.view.is2d() ? \"2d\" : \"3d\";\r\n    this.title = `[ ${this.viewport.viewportId} ] ${viewName} <${id}> (${dim})`;\r\n  }\r\n\r\n  private updateActiveSettings(): void {\r\n    // NOTE: First category/model is fine for testing purposes...\r\n    const view = this.viewport.view;\r\n    if (!view.iModel.isBriefcaseConnection())\r\n      return;\r\n\r\n    const settings = view.iModel.editorToolSettings;\r\n    if (undefined === settings.category || !view.viewsCategory(settings.category)) {\r\n      settings.category = undefined;\r\n      for (const catId of view.categorySelector.categories) {\r\n        settings.category = catId;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (undefined === settings.model || !view.viewsModel(settings.model)) {\r\n      settings.model = undefined;\r\n      if (view.is2d()) {\r\n        settings.model = view.baseModelId;\r\n      } else if (view.isSpatialView()) {\r\n        settings.model = undefined;\r\n        for (const modId of view.modelSelector.models) {\r\n          settings.model = modId;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private async changeView(id: Id64String): Promise<void> {\r\n    const view = await this.views.getView(id, this._imodel);\r\n    await this.setView(view.clone());\r\n    for (const control of this._3dOnly)\r\n      control.style.display = this.viewport.view.is3d() ? \"block\" : \"none\";\r\n  }\r\n\r\n  public async setView(view: ViewState, isSavedView = false): Promise<void> {\r\n    this._isSavedView = isSavedView;\r\n    this.viewport.changeView(view);\r\n    this._maybeDisableEdges();\r\n    this.updateTitle();\r\n    this.updateActiveSettings();\r\n    await this.toolBar.onViewChanged(this.viewport);\r\n  }\r\n\r\n  public async applySavedView(view: ViewState): Promise<void> {\r\n    return this.setView(view, true);\r\n  }\r\n\r\n  private async openView(view: ViewState): Promise<void> {\r\n    await this.setView(view);\r\n    IModelApp.viewManager.addViewport(this.viewport);\r\n  }\r\n\r\n  private async clearViews(): Promise<void> {\r\n    await this.closeIModel();\r\n    this.views.clear();\r\n  }\r\n\r\n  private async buildViewList(): Promise<void> {\r\n    await this.views.populate(this._imodel);\r\n    this._viewPicker.populate(this.views);\r\n  }\r\n\r\n  private async resetIModel(props: OpenIModelProps): Promise<void> {\r\n    const { fileName, iModelId } = props;\r\n    let newIModel: IModelConnection;\r\n    const sameFile = (fileName !== undefined && fileName === this._imodel.key) || (iModelId !== undefined && iModelId === this._imodel.iModelId);\r\n    if (!sameFile) {\r\n      try {\r\n        newIModel = await openIModel({ ...props, writable: this.surface.openReadWrite });\r\n      } catch (err: any) {\r\n        alert(err.toString());\r\n        return;\r\n      }\r\n    }\r\n\r\n    Surface.instance.onResetIModel(this);\r\n    IModelApp.viewManager.dropViewport(this.viewport, false);\r\n\r\n    await this.clearViews();\r\n\r\n    if (sameFile)\r\n      newIModel = await openIModel({ ...props, writable: this.surface.openReadWrite });\r\n\r\n    this._imodel = newIModel!;\r\n    await this.buildViewList();\r\n    const view = await this.views.getDefaultView(this._imodel);\r\n    await this.openView(view);\r\n  }\r\n\r\n  public async openFile(fileName?: string): Promise<void> {\r\n    return undefined !== fileName ? this.openIModel({ fileName, writable: this.surface.openReadWrite }) : this.selectIModel();\r\n  }\r\n\r\n  private async selectIModel(): Promise<void> {\r\n    const fileName = await this.surface.selectFileName();\r\n    return undefined !== fileName ? this.openIModel({ fileName, writable: this.surface.openReadWrite }) : Promise.resolve();\r\n  }\r\n\r\n  private async openIModel(props: OpenIModelProps): Promise<void> {\r\n    try {\r\n      await this.resetIModel(props);\r\n      setTitle(this._imodel);\r\n    } catch {\r\n      alert(\"Error - could not open file.\");\r\n    }\r\n  }\r\n\r\n  private async closeIModel(): Promise<void> {\r\n    return this._imodel.close();\r\n  }\r\n\r\n  public override onFocus(): void {\r\n    this._header.element.classList.add(\"viewport-header-focused\");\r\n    void IModelApp.viewManager.setSelectedView(this.viewport);\r\n  }\r\n\r\n  public override onLoseFocus(): void {\r\n    this._header.element.classList.remove(\"viewport-header-focused\");\r\n  }\r\n\r\n  public onSelected(): void {\r\n    this._header.element.classList.add(\"viewport-header-selected\");\r\n    this.container.classList.add(\"viewport-selected\");\r\n  }\r\n\r\n  public onDeselected(): void {\r\n    this._header.element.classList.remove(\"viewport-header-selected\");\r\n    this.container.classList.remove(\"viewport-selected\");\r\n  }\r\n\r\n  public get windowId(): string { return this.viewport.viewportId.toString(); }\r\n\r\n  public override onClosing(): void {\r\n    this.toolBar.dispose();\r\n    if (this._debugWindow) {\r\n      this._debugWindow.dispose();\r\n      this._debugWindow = undefined;\r\n    }\r\n\r\n    IModelApp.viewManager.dropViewport(this.viewport, true);\r\n  }\r\n\r\n  public override onClosed(): void {\r\n    if (undefined === IModelApp.viewManager.selectedView) {\r\n      IModelApp.notifications.outputMessage(new NotifyMessageDetails(OutputMessagePriority.Info, \"Closing iModel...\"));\r\n\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.closeIModel().then(() => IModelApp.notifications.outputMessage(new NotifyMessageDetails(OutputMessagePriority.Info, \"iModel closed.\")));\r\n    }\r\n  }\r\n\r\n  public toggleDebugWindow(): void {\r\n    if (!this._debugWindow)\r\n      this._debugWindow = new DebugWindow(this.viewport);\r\n\r\n    this._debugWindow.toggle();\r\n  }\r\n}\r\n",
      "start": 1693508121253,
      "end": 1693508121319,
      "sourcemaps": null
    },
    {
      "name": "vite:esbuild",
      "result": "\"use strict\";\nimport { ClipPlane, ClipPrimitive, ClipVector, ConvexClipPlaneSet, Vector3d } from \"@itwin/core-geometry\";\nimport { ModelClipGroup, ModelClipGroups } from \"@itwin/core-common\";\nimport {\n  IModelApp,\n  NotifyMessageDetails,\n  openImageDataUrlInNewWindow,\n  OutputMessagePriority,\n  ScreenViewport,\n  Tool\n} from \"@itwin/core-frontend\";\nimport { parseArgs } from \"@itwin/frontend-devtools\";\nimport { MarkupApp } from \"@itwin/core-markup\";\nimport { ClassificationsPanel } from \"./ClassificationsPanel\";\nimport { DebugWindow } from \"./DebugWindow\";\nimport { FeatureOverridesPanel } from \"./FeatureOverrides\";\nimport { CategoryPicker, ModelPicker } from \"./IdPicker\";\nimport { SavedViewPicker } from \"./SavedViews\";\nimport { CameraPathsMenu } from \"./CameraPaths\";\nimport { SectionsPanel } from \"./SectionTools\";\nimport { StandardRotations } from \"./StandardRotations\";\nimport { Surface } from \"./Surface\";\nimport { createTimeline } from \"./Timeline\";\nimport { setTitle } from \"./Title\";\nimport { createImageButton, createToolButton, ToolBar } from \"./ToolBar\";\nimport { ViewAttributesPanel } from \"./ViewAttributes\";\nimport { ViewList, ViewPicker } from \"./ViewPicker\";\nimport { Window } from \"./Window\";\nimport { openIModel } from \"./openIModel\";\nimport { HubPicker } from \"./HubPicker\";\nimport { RealityModelSettingsPanel } from \"./RealityModelDisplaySettingsWidget\";\nasync function zoomToSelectedElements(vp, options) {\n  const elems = vp.iModel.selectionSet.elements;\n  if (0 < elems.size)\n    await vp.zoomToElements(elems, { animateFrustumChange: true, ...options });\n}\nexport class ZoomToSelectedElementsTool extends Tool {\n  static get maxArgs() {\n    return 4;\n  }\n  async run() {\n    const vp = IModelApp.viewManager.selectedView;\n    if (void 0 !== vp) {\n      await zoomToSelectedElements(vp, {\n        marginPercent: this._margin,\n        paddingPercent: this._padding\n      });\n    }\n    return true;\n  }\n  async parseAndRun(...input) {\n    const args = parseArgs(input);\n    const padding = args.getFloat(\"p\");\n    if (void 0 !== padding) {\n      if (args.getBoolean(\"m\"))\n        this._margin = { left: padding, right: padding, top: padding, bottom: padding };\n      else\n        this._padding = padding;\n    } else {\n      const left = args.getFloat(\"l\") ?? 0;\n      const right = args.getFloat(\"r\") ?? 0;\n      const top = args.getFloat(\"t\") ?? 0;\n      const bottom = args.getFloat(\"b\") ?? 0;\n      if (void 0 !== left || void 0 !== right || void 0 !== top || void 0 !== bottom) {\n        if (args.getBoolean(\"m\"))\n          this._margin = { left, right, top, bottom };\n        else\n          this._padding = { left, right, top, bottom };\n      }\n    }\n    return this.run();\n  }\n}\nZoomToSelectedElementsTool.toolId = \"ZoomToSelectedElements\";\nexport class ModelClipTool extends Tool {\n  async run(_args) {\n    const view = IModelApp.viewManager.selectedView?.view;\n    if (!view || !view.isSpatialView() || view.modelSelector.models.size < 2)\n      return true;\n    const createClip = (vector) => {\n      const plane = ClipPlane.createNormalAndPoint(vector, view.iModel.projectExtents.center);\n      const planes = ConvexClipPlaneSet.createPlanes([plane]);\n      const primitive = ClipPrimitive.createCapture(planes);\n      return ClipVector.createCapture([primitive]);\n    };\n    const leftModels = [];\n    const rightModels = [];\n    let left = true;\n    view.modelSelector.models.forEach((model) => {\n      (left ? leftModels : rightModels).push(model);\n      left = !left;\n    });\n    view.details.modelClipGroups = new ModelClipGroups([\n      ModelClipGroup.create(createClip(Vector3d.unitX().negate()), rightModels),\n      ModelClipGroup.create(createClip(Vector3d.unitZ().negate()), leftModels)\n    ]);\n    IModelApp.viewManager.selectedView.invalidateScene();\n    return true;\n  }\n}\nModelClipTool.toolId = \"ModelClip\";\nconst _MarkupTool = class _MarkupTool extends Tool {\n  static get minArgs() {\n    return 0;\n  }\n  static get maxArgs() {\n    return 1;\n  }\n  async run(wantSavedData) {\n    const vp = IModelApp.viewManager.selectedView;\n    if (void 0 === vp)\n      return true;\n    if (MarkupApp.isActive) {\n      const startMarkupSelect = IModelApp.toolAdmin.defaultToolId === MarkupApp.markupSelectToolId && (void 0 === IModelApp.toolAdmin.activeTool || MarkupApp.markupSelectToolId !== IModelApp.toolAdmin.activeTool.toolId);\n      if (startMarkupSelect) {\n        await IModelApp.toolAdmin.startDefaultTool();\n        return true;\n      }\n      MarkupApp.props.result.maxWidth = 1500;\n      MarkupApp.stop().then((markupData) => {\n        if (wantSavedData)\n          _MarkupTool.savedData = markupData;\n        if (void 0 !== markupData.image)\n          openImageDataUrlInNewWindow(markupData.image, \"Markup\");\n      }).catch((_) => {\n      });\n    } else {\n      MarkupApp.props.active.element.stroke = \"white\";\n      MarkupApp.markupSelectToolId = \"Markup.TestSelect\";\n      await MarkupApp.start(vp, wantSavedData ? _MarkupTool.savedData : void 0);\n    }\n    return true;\n  }\n  async parseAndRun(...args) {\n    const wantSavedData = \"savedata\" === args[0]?.toLowerCase();\n    return this.run(wantSavedData);\n  }\n};\n_MarkupTool.toolId = \"Markup\";\nexport let MarkupTool = _MarkupTool;\nexport class Viewer extends Window {\n  constructor(surface, view, views, props) {\n    super(surface, { scrollbars: true });\n    this._3dOnly = [];\n    this._isSavedView = false;\n    this.contentDiv.style.backgroundColor = \"transparent\";\n    this.container.style.backgroundColor = \"transparent\";\n    surface.element.appendChild(this.container);\n    this.disableEdges = true === props.disableEdges;\n    this._imodel = props.iModel;\n    this.viewport = ScreenViewport.create(this.contentDiv, view);\n    this.views = views;\n    this._maybeDisableEdges();\n    this.toolBar = new ToolBar(IModelApp.makeHTMLElement(\"div\", { className: \"topdiv\" }));\n    this.toolBar.addItem(createToolButton({\n      iconUnicode: \"\",\n      // properties\n      tooltip: \"Debug info\",\n      click: () => this.toggleDebugWindow()\n    }));\n    this.toolBar.addItem(createToolButton({\n      iconUnicode: \"\",\n      tooltip: \"Open iModel from disk\",\n      click: async () => {\n        await this.selectIModel();\n      }\n    }));\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // cloud-download\n      tooltip: \"Open iModel from hub\",\n      createDropDown: async (container) => {\n        const picker = new HubPicker(container, async (iModelId, iTwinId) => {\n          alert(`About to download and open hub iModel. Note that this could take quite some time without any feedback.`);\n          await this.openIModel({\n            iModelId,\n            iTwinId,\n            writable: this.surface.openReadWrite\n          });\n          picker.close();\n        });\n        await picker.populate();\n        return picker;\n      }\n    });\n    this._viewPicker = new ViewPicker(this.toolBar.element, this.views);\n    this._viewPicker.onSelectedViewChanged.addListener(async (id) => this.changeView(id));\n    this._viewPicker.element.addEventListener(\"click\", () => this.toolBar.close());\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"model\"\n      tooltip: \"Models\",\n      only3d: true,\n      createDropDown: async (container) => {\n        const picker = new ModelPicker(this.viewport, container);\n        await picker.populate();\n        return picker;\n      }\n    });\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"categories\"\n      tooltip: \"Categories\",\n      createDropDown: async (container) => {\n        const picker = new CategoryPicker(this.viewport, container);\n        await picker.populate();\n        return picker;\n      }\n    });\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"savedview\"\n      tooltip: \"External saved views\",\n      createDropDown: async (container) => {\n        const picker = new SavedViewPicker(this.viewport, container, this);\n        await picker.populate();\n        return picker;\n      }\n    });\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      tooltip: \"Saved camera paths\",\n      createDropDown: async (container) => {\n        const picker = new CameraPathsMenu(this.viewport, container);\n        await picker.populate();\n        return picker;\n      }\n    });\n    this.toolBar.addItem(createImageButton({\n      src: \"zoom.svg\",\n      click: async () => IModelApp.tools.run(\"SVTSelect\"),\n      tooltip: \"Element selection\"\n    }));\n    this.toolBar.addItem(createToolButton({\n      iconUnicode: \"\",\n      click: async () => IModelApp.tools.run(\"Measure.Distance\", IModelApp.viewManager.selectedView),\n      tooltip: \"Measure distance\"\n    }));\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      tooltip: \"View settings\",\n      createDropDown: async (container) => {\n        const panel = new ViewAttributesPanel(this.viewport, container, this.disableEdges);\n        await panel.populate();\n        return panel;\n      }\n    });\n    this.toolBar.addItem(createImageButton({\n      src: \"fit-to-view.svg\",\n      click: async () => IModelApp.tools.run(\"View.Fit\", this.viewport, true),\n      tooltip: \"Fit view\"\n    }));\n    this.toolBar.addItem(createImageButton({\n      src: \"window-area.svg\",\n      click: async () => IModelApp.tools.run(\"View.WindowArea\", this.viewport),\n      tooltip: \"Window area\"\n    }));\n    this.toolBar.addItem(createImageButton({\n      src: \"rotate-left.svg\",\n      click: async () => IModelApp.tools.run(\"View.Rotate\", this.viewport),\n      tooltip: \"Rotate\"\n    }));\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"gyroscope\"\n      createDropDown: async (container) => new StandardRotations(container, this.viewport),\n      tooltip: \"Standard rotations\",\n      only3d: true\n    });\n    const walk = createImageButton({\n      src: \"walk.svg\",\n      click: async () => IModelApp.tools.run(\"View.LookAndMove\", this.viewport),\n      tooltip: \"Walk\"\n    });\n    this._3dOnly.push(walk);\n    this.toolBar.addItem(walk);\n    this.toolBar.addItem(createToolButton({\n      iconUnicode: \"\",\n      // \"undo\"\n      click: async () => IModelApp.tools.run(\"View.Undo\", this.viewport),\n      tooltip: \"View undo\"\n    }));\n    this.toolBar.addItem(createToolButton({\n      iconUnicode: \"\",\n      // \"redo\"\n      click: async () => IModelApp.tools.run(\"View.Redo\", this.viewport),\n      tooltip: \"View redo\"\n    }));\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"animation\"\n      createDropDown: async (container) => createTimeline(this.viewport, container, 10),\n      tooltip: \"Animation / solar time\"\n    });\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"viewtop\"\n      tooltip: \"Sectioning tools\",\n      createDropDown: async (container) => new SectionsPanel(this.viewport, container)\n    });\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"property-data\"\n      tooltip: \"Spatial Classification\",\n      only3d: true,\n      createDropDown: async (container) => {\n        const panel = new ClassificationsPanel(this.viewport, container);\n        await panel.populate();\n        return panel;\n      }\n    });\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"isolate\"\n      createDropDown: async (container) => new FeatureOverridesPanel(this.viewport, container),\n      tooltip: \"Override feature symbology\"\n    });\n    this.toolBar.addDropDown({\n      iconUnicode: \"\",\n      // \"pencil\"  ###TODO where to get real icon?\n      createDropDown: async (container) => {\n        const panel = new RealityModelSettingsPanel(this.viewport, container);\n        await panel.populate();\n        return panel;\n      },\n      tooltip: \"Point cloud settings\"\n    });\n    this.updateTitle();\n    this.updateActiveSettings();\n  }\n  static async create(surface, props) {\n    const views = await ViewList.create(props.iModel, props.defaultViewName);\n    const view = await views.getDefaultView(props.iModel);\n    const viewer = new Viewer(surface, view, views, props);\n    return viewer;\n  }\n  clone() {\n    const view = this.viewport.view.clone();\n    const viewer = new Viewer(Surface.instance, view, this.views, {\n      iModel: view.iModel,\n      disableEdges: this.disableEdges\n    });\n    if (!this.isDocked) {\n      viewer.container.style.width = this.container.style.width;\n      viewer.container.style.height = this.container.style.height;\n      const style = getComputedStyle(this.container, null);\n      const pxToNum = (propName) => parseFloat(style.getPropertyValue(propName).replace(\"px\", \"\")) + 40;\n      viewer.container.style.top = `${pxToNum(\"top\")}px`;\n      viewer.container.style.left = `${pxToNum(\"left\")}px`;\n    }\n    return viewer;\n  }\n  _maybeDisableEdges() {\n    if (this.disableEdges && (this.viewport.viewFlags.visibleEdges || this.viewport.viewFlags.hiddenEdges)) {\n      this.viewport.viewFlags = this.viewport.viewFlags.copy({ visibleEdges: false, hiddenEdges: false });\n    }\n  }\n  updateTitle() {\n    let viewName = this.viewport.view.code.value;\n    if (void 0 === viewName || 0 === viewName.length)\n      viewName = \"UNNAMED\";\n    const id = !this._isSavedView ? this.viewport.view.id : \"Saved View\";\n    const dim = this.viewport.view.is2d() ? \"2d\" : \"3d\";\n    this.title = `[ ${this.viewport.viewportId} ] ${viewName} <${id}> (${dim})`;\n  }\n  updateActiveSettings() {\n    const view = this.viewport.view;\n    if (!view.iModel.isBriefcaseConnection())\n      return;\n    const settings = view.iModel.editorToolSettings;\n    if (void 0 === settings.category || !view.viewsCategory(settings.category)) {\n      settings.category = void 0;\n      for (const catId of view.categorySelector.categories) {\n        settings.category = catId;\n        break;\n      }\n    }\n    if (void 0 === settings.model || !view.viewsModel(settings.model)) {\n      settings.model = void 0;\n      if (view.is2d()) {\n        settings.model = view.baseModelId;\n      } else if (view.isSpatialView()) {\n        settings.model = void 0;\n        for (const modId of view.modelSelector.models) {\n          settings.model = modId;\n          break;\n        }\n      }\n    }\n  }\n  async changeView(id) {\n    const view = await this.views.getView(id, this._imodel);\n    await this.setView(view.clone());\n    for (const control of this._3dOnly)\n      control.style.display = this.viewport.view.is3d() ? \"block\" : \"none\";\n  }\n  async setView(view, isSavedView = false) {\n    this._isSavedView = isSavedView;\n    this.viewport.changeView(view);\n    this._maybeDisableEdges();\n    this.updateTitle();\n    this.updateActiveSettings();\n    await this.toolBar.onViewChanged(this.viewport);\n  }\n  async applySavedView(view) {\n    return this.setView(view, true);\n  }\n  async openView(view) {\n    await this.setView(view);\n    IModelApp.viewManager.addViewport(this.viewport);\n  }\n  async clearViews() {\n    await this.closeIModel();\n    this.views.clear();\n  }\n  async buildViewList() {\n    await this.views.populate(this._imodel);\n    this._viewPicker.populate(this.views);\n  }\n  async resetIModel(props) {\n    const { fileName, iModelId } = props;\n    let newIModel;\n    const sameFile = fileName !== void 0 && fileName === this._imodel.key || iModelId !== void 0 && iModelId === this._imodel.iModelId;\n    if (!sameFile) {\n      try {\n        newIModel = await openIModel({ ...props, writable: this.surface.openReadWrite });\n      } catch (err) {\n        alert(err.toString());\n        return;\n      }\n    }\n    Surface.instance.onResetIModel(this);\n    IModelApp.viewManager.dropViewport(this.viewport, false);\n    await this.clearViews();\n    if (sameFile)\n      newIModel = await openIModel({ ...props, writable: this.surface.openReadWrite });\n    this._imodel = newIModel;\n    await this.buildViewList();\n    const view = await this.views.getDefaultView(this._imodel);\n    await this.openView(view);\n  }\n  async openFile(fileName) {\n    return void 0 !== fileName ? this.openIModel({ fileName, writable: this.surface.openReadWrite }) : this.selectIModel();\n  }\n  async selectIModel() {\n    const fileName = await this.surface.selectFileName();\n    return void 0 !== fileName ? this.openIModel({ fileName, writable: this.surface.openReadWrite }) : Promise.resolve();\n  }\n  async openIModel(props) {\n    try {\n      await this.resetIModel(props);\n      setTitle(this._imodel);\n    } catch {\n      alert(\"Error - could not open file.\");\n    }\n  }\n  async closeIModel() {\n    return this._imodel.close();\n  }\n  onFocus() {\n    this._header.element.classList.add(\"viewport-header-focused\");\n    void IModelApp.viewManager.setSelectedView(this.viewport);\n  }\n  onLoseFocus() {\n    this._header.element.classList.remove(\"viewport-header-focused\");\n  }\n  onSelected() {\n    this._header.element.classList.add(\"viewport-header-selected\");\n    this.container.classList.add(\"viewport-selected\");\n  }\n  onDeselected() {\n    this._header.element.classList.remove(\"viewport-header-selected\");\n    this.container.classList.remove(\"viewport-selected\");\n  }\n  get windowId() {\n    return this.viewport.viewportId.toString();\n  }\n  onClosing() {\n    this.toolBar.dispose();\n    if (this._debugWindow) {\n      this._debugWindow.dispose();\n      this._debugWindow = void 0;\n    }\n    IModelApp.viewManager.dropViewport(this.viewport, true);\n  }\n  onClosed() {\n    if (void 0 === IModelApp.viewManager.selectedView) {\n      IModelApp.notifications.outputMessage(new NotifyMessageDetails(OutputMessagePriority.Info, \"Closing iModel...\"));\n      this.closeIModel().then(() => IModelApp.notifications.outputMessage(new NotifyMessageDetails(OutputMessagePriority.Info, \"iModel closed.\")));\n    }\n  }\n  toggleDebugWindow() {\n    if (!this._debugWindow)\n      this._debugWindow = new DebugWindow(this.viewport);\n    this._debugWindow.toggle();\n  }\n}\n",
      "start": 1693508121319,
      "end": 1693508121653,
      "order": "normal",
      "sourcemaps": {
        "version": 3,
        "sources": [
          "D:/hub2023A/itwinjs-core/test-apps/display-test-app/src/frontend/Viewer.ts"
        ],
        "sourcesContent": [
          "/*---------------------------------------------------------------------------------------------\r\n* Copyright (c) Bentley Systems, Incorporated. All rights reserved.\r\n* See LICENSE.md in the project root for license terms and full copyright notice.\r\n*--------------------------------------------------------------------------------------------*/\r\nimport { Id64String } from \"@itwin/core-bentley\";\r\nimport { ClipPlane, ClipPrimitive, ClipVector, ConvexClipPlaneSet, Vector3d } from \"@itwin/core-geometry\";\r\nimport { ModelClipGroup, ModelClipGroups } from \"@itwin/core-common\";\r\nimport {\r\n  IModelApp, IModelConnection, MarginOptions, MarginPercent, NotifyMessageDetails, openImageDataUrlInNewWindow, OutputMessagePriority,\r\n  PaddingPercent, ScreenViewport, Tool, Viewport, ViewState,\r\n} from \"@itwin/core-frontend\";\r\nimport { parseArgs } from \"@itwin/frontend-devtools\";\r\nimport { MarkupApp, MarkupData } from \"@itwin/core-markup\";\r\nimport { ClassificationsPanel } from \"./ClassificationsPanel\";\r\nimport { DebugWindow } from \"./DebugWindow\";\r\nimport { FeatureOverridesPanel } from \"./FeatureOverrides\";\r\nimport { CategoryPicker, ModelPicker } from \"./IdPicker\";\r\nimport { SavedViewPicker } from \"./SavedViews\";\r\nimport { CameraPathsMenu } from \"./CameraPaths\";\r\nimport { SectionsPanel } from \"./SectionTools\";\r\nimport { StandardRotations } from \"./StandardRotations\";\r\nimport { Surface } from \"./Surface\";\r\nimport { createTimeline } from \"./Timeline\";\r\nimport { setTitle } from \"./Title\";\r\nimport { createImageButton, createToolButton, ToolBar } from \"./ToolBar\";\r\nimport { ViewAttributesPanel } from \"./ViewAttributes\";\r\nimport { ViewList, ViewPicker } from \"./ViewPicker\";\r\nimport { Window } from \"./Window\";\r\nimport { openIModel, OpenIModelProps } from \"./openIModel\";\r\nimport { HubPicker } from \"./HubPicker\";\r\nimport { RealityModelSettingsPanel } from \"./RealityModelDisplaySettingsWidget\";\r\n\r\n// cspell:ignore savedata topdiv savedview viewtop\r\n\r\nasync function zoomToSelectedElements(vp: Viewport, options?: MarginOptions) {\r\n  const elems = vp.iModel.selectionSet.elements;\r\n  if (0 < elems.size)\r\n    await vp.zoomToElements(elems, { animateFrustumChange: true, ...options });\r\n}\r\n\r\nexport class ZoomToSelectedElementsTool extends Tool {\r\n  private _margin?: MarginPercent;\r\n  private _padding?: PaddingPercent | number;\r\n\r\n  public static override toolId = \"ZoomToSelectedElements\";\r\n  public static override get maxArgs() { return 4; }\r\n\r\n  public override async run(): Promise<boolean> {\r\n    const vp = IModelApp.viewManager.selectedView;\r\n    if (undefined !== vp) {\r\n      await zoomToSelectedElements(vp, {\r\n        marginPercent: this._margin,\r\n        paddingPercent: this._padding,\r\n      });\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public override async parseAndRun(...input: string[]): Promise<boolean> {\r\n    const args = parseArgs(input);\r\n    const padding = args.getFloat(\"p\");\r\n    if (undefined !== padding) {\r\n      if (args.getBoolean(\"m\"))\r\n        this._margin = { left: padding, right: padding, top: padding, bottom: padding };\r\n      else\r\n        this._padding = padding;\r\n    } else {\r\n      const left = args.getFloat(\"l\") ?? 0;\r\n      const right = args.getFloat(\"r\") ?? 0;\r\n      const top = args.getFloat(\"t\") ?? 0;\r\n      const bottom = args.getFloat(\"b\") ?? 0;\r\n      if (undefined !== left || undefined !== right || undefined !== top || undefined !== bottom) {\r\n        if (args.getBoolean(\"m\"))\r\n          this._margin = { left, right, top, bottom };\r\n        else\r\n          this._padding = { left, right, top, bottom };\r\n      }\r\n    }\r\n\r\n    return this.run();\r\n  }\r\n}\r\n\r\nexport class ModelClipTool extends Tool {\r\n  public static override toolId = \"ModelClip\";\r\n  public override async run(_args: any[]): Promise<boolean> {\r\n    const view = IModelApp.viewManager.selectedView?.view;\r\n    if (!view || !view.isSpatialView() || view.modelSelector.models.size < 2)\r\n      return true;\r\n\r\n    const createClip = (vector: Vector3d) => {\r\n      const plane = ClipPlane.createNormalAndPoint(vector, view.iModel.projectExtents.center)!;\r\n      const planes = ConvexClipPlaneSet.createPlanes([plane]);\r\n      const primitive = ClipPrimitive.createCapture(planes);\r\n      return ClipVector.createCapture([primitive]);\r\n    };\r\n\r\n    const leftModels: string[] = [];\r\n    const rightModels: string[] = [];\r\n    let left = true;\r\n    view.modelSelector.models.forEach((model) => {\r\n      (left ? leftModels : rightModels).push(model);\r\n      left = !left;\r\n    });\r\n\r\n    view.details.modelClipGroups = new ModelClipGroups([\r\n      ModelClipGroup.create(createClip(Vector3d.unitX().negate()), rightModels),\r\n      ModelClipGroup.create(createClip(Vector3d.unitZ().negate()), leftModels),\r\n    ]);\r\n\r\n    IModelApp.viewManager.selectedView!.invalidateScene();\r\n    return true;\r\n  }\r\n}\r\n\r\nexport class MarkupTool extends Tool {\r\n  public static override toolId = \"Markup\";\r\n  public static savedData?: MarkupData;\r\n  public static override get minArgs() { return 0; }\r\n  public static override get maxArgs() { return 1; }\r\n\r\n  public override async run(wantSavedData: boolean): Promise<boolean> {\r\n    const vp = IModelApp.viewManager.selectedView;\r\n    if (undefined === vp)\r\n      return true;\r\n\r\n    if (MarkupApp.isActive) {\r\n      // NOTE: Because we don't have separate START and STOP buttons in the test app, exit markup mode only when the Markup Select tool is active, otherwise start the Markup Select tool...\r\n      const startMarkupSelect = IModelApp.toolAdmin.defaultToolId === MarkupApp.markupSelectToolId && (undefined === IModelApp.toolAdmin.activeTool || MarkupApp.markupSelectToolId !== IModelApp.toolAdmin.activeTool.toolId);\r\n      if (startMarkupSelect) {\r\n        await IModelApp.toolAdmin.startDefaultTool();\r\n        return true;\r\n      }\r\n      MarkupApp.props.result.maxWidth = 1500;\r\n      MarkupApp.stop().then((markupData) => {\r\n        if (wantSavedData)\r\n          MarkupTool.savedData = markupData;\r\n        if (undefined !== markupData.image)\r\n          openImageDataUrlInNewWindow(markupData.image, \"Markup\");\r\n      }).catch((_) => { });\r\n    } else {\r\n      MarkupApp.props.active.element.stroke = \"white\"; // as an example, set default color for elements\r\n      MarkupApp.markupSelectToolId = \"Markup.TestSelect\"; // as an example override the default markup select tool to launch redline tools using key events\r\n      await MarkupApp.start(vp, wantSavedData ? MarkupTool.savedData : undefined);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public override async parseAndRun(...args: string[]): Promise<boolean> {\r\n    const wantSavedData = \"savedata\" === args[0]?.toLowerCase();\r\n    return this.run(wantSavedData);\r\n  }\r\n}\r\n\r\nexport interface ViewerProps {\r\n  iModel: IModelConnection;\r\n  defaultViewName?: string;\r\n  disableEdges?: boolean;\r\n}\r\n\r\nexport class Viewer extends Window {\r\n  public readonly views: ViewList;\r\n  public readonly viewport: ScreenViewport;\r\n  public readonly toolBar: ToolBar;\r\n  public readonly disableEdges: boolean;\r\n  private _imodel: IModelConnection;\r\n  private readonly _viewPicker: ViewPicker;\r\n  private readonly _3dOnly: HTMLElement[] = [];\r\n  private _isSavedView = false;\r\n  private _debugWindow?: DebugWindow;\r\n\r\n  public static async create(surface: Surface, props: ViewerProps): Promise<Viewer> {\r\n    const views = await ViewList.create(props.iModel, props.defaultViewName);\r\n    const view = await views.getDefaultView(props.iModel);\r\n    const viewer = new Viewer(surface, view, views, props);\r\n    return viewer;\r\n  }\r\n\r\n  public clone(): Viewer {\r\n    const view = this.viewport.view.clone();\r\n    const viewer = new Viewer(Surface.instance, view, this.views, {\r\n      iModel: view.iModel,\r\n      disableEdges: this.disableEdges,\r\n    });\r\n\r\n    if (!this.isDocked) {\r\n      // Match dimensions\r\n      viewer.container.style.width = this.container.style.width;\r\n      viewer.container.style.height = this.container.style.height;\r\n\r\n      // Offset position from top-left corner\r\n      const style = getComputedStyle(this.container, null);\r\n      const pxToNum = (propName: string) => parseFloat(style.getPropertyValue(propName).replace(\"px\", \"\")) + 40;\r\n      viewer.container.style.top = `${pxToNum(\"top\")}px`;\r\n      viewer.container.style.left = `${pxToNum(\"left\")}px`;\r\n    }\r\n\r\n    return viewer;\r\n  }\r\n\r\n  private _maybeDisableEdges() {\r\n    if (this.disableEdges && (this.viewport.viewFlags.visibleEdges || this.viewport.viewFlags.hiddenEdges)) {\r\n      this.viewport.viewFlags = this.viewport.viewFlags.copy({ visibleEdges: false, hiddenEdges: false });\r\n    }\r\n  }\r\n\r\n  private constructor(surface: Surface, view: ViewState, views: ViewList, props: ViewerProps) {\r\n    super(surface, { scrollbars: true });\r\n\r\n    // Allow HTMLElements beneath viewport to be visible if background color has transparency.\r\n    this.contentDiv.style.backgroundColor = \"transparent\";\r\n    this.container.style.backgroundColor = \"transparent\";\r\n    surface.element.appendChild(this.container);\r\n\r\n    this.disableEdges = true === props.disableEdges;\r\n    this._imodel = props.iModel;\r\n    this.viewport = ScreenViewport.create(this.contentDiv, view);\r\n    this.views = views;\r\n\r\n    this._maybeDisableEdges();\r\n\r\n    this.toolBar = new ToolBar(IModelApp.makeHTMLElement(\"div\", { className: \"topdiv\" }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue90c\", // properties\r\n      tooltip: \"Debug info\",\r\n      click: () => this.toggleDebugWindow(),\r\n    }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue9cc\",\r\n      tooltip: \"Open iModel from disk\",\r\n      click: async () => {\r\n        await this.selectIModel();\r\n      },\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue9e0\", // cloud-download\r\n      tooltip: \"Open iModel from hub\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new HubPicker(container, async (iModelId, iTwinId) => {\r\n          alert(`About to download and open hub iModel. Note that this could take quite some time without any feedback.`);\r\n          await this.openIModel({\r\n            iModelId,\r\n            iTwinId,\r\n            writable: this.surface.openReadWrite,\r\n          });\r\n          picker.close();\r\n        });\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this._viewPicker = new ViewPicker(this.toolBar.element, this.views);\r\n    this._viewPicker.onSelectedViewChanged.addListener(async (id) => this.changeView(id));\r\n    this._viewPicker.element.addEventListener(\"click\", () => this.toolBar.close());\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90b\", // \"model\"\r\n      tooltip: \"Models\",\r\n      only3d: true,\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new ModelPicker(this.viewport, container);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue901\", // \"categories\"\r\n      tooltip: \"Categories\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new CategoryPicker(this.viewport, container);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90d\", // \"savedview\"\r\n      tooltip: \"External saved views\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new SavedViewPicker(this.viewport, container, this);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue932\",\r\n      tooltip: \"Saved camera paths\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const picker = new CameraPathsMenu(this.viewport, container);\r\n        await picker.populate();\r\n        return picker;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"zoom.svg\",\r\n      click: async () => IModelApp.tools.run(\"SVTSelect\"),\r\n      tooltip: \"Element selection\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ueb08\",\r\n      click: async () => IModelApp.tools.run(\"Measure.Distance\", IModelApp.viewManager.selectedView!),\r\n      tooltip: \"Measure distance\",\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90e\",\r\n      tooltip: \"View settings\",\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const panel = new ViewAttributesPanel(this.viewport, container, this.disableEdges);\r\n        await panel.populate();\r\n        return panel;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"fit-to-view.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.Fit\", this.viewport, true),\r\n      tooltip: \"Fit view\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"window-area.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.WindowArea\", this.viewport),\r\n      tooltip: \"Window area\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createImageButton({\r\n      src: \"rotate-left.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.Rotate\", this.viewport),\r\n      tooltip: \"Rotate\",\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue909\", // \"gyroscope\"\r\n      createDropDown: async (container: HTMLElement) => new StandardRotations(container, this.viewport),\r\n      tooltip: \"Standard rotations\",\r\n      only3d: true,\r\n    });\r\n\r\n    const walk = createImageButton({\r\n      src: \"walk.svg\",\r\n      click: async () => IModelApp.tools.run(\"View.LookAndMove\", this.viewport),\r\n      tooltip: \"Walk\",\r\n    });\r\n    this._3dOnly.push(walk);\r\n    this.toolBar.addItem(walk);\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue982\", // \"undo\"\r\n      click: async () => IModelApp.tools.run(\"View.Undo\", this.viewport),\r\n      tooltip: \"View undo\",\r\n    }));\r\n\r\n    this.toolBar.addItem(createToolButton({\r\n      iconUnicode: \"\\ue983\", // \"redo\"\r\n      click: async () => IModelApp.tools.run(\"View.Redo\", this.viewport),\r\n      tooltip: \"View redo\",\r\n    }));\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue931\", // \"animation\"\r\n      createDropDown: async (container: HTMLElement) => createTimeline(this.viewport, container, 10),\r\n      tooltip: \"Animation / solar time\",\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue916\", // \"viewtop\"\r\n      tooltip: \"Sectioning tools\",\r\n      createDropDown: async (container: HTMLElement) => new SectionsPanel(this.viewport, container),\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue9d8\", // \"property-data\"\r\n      tooltip: \"Spatial Classification\",\r\n      only3d: true,\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const panel = new ClassificationsPanel(this.viewport, container);\r\n        await panel.populate();\r\n        return panel;\r\n      },\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue90a\", // \"isolate\"\r\n      createDropDown: async (container: HTMLElement) => new FeatureOverridesPanel(this.viewport, container),\r\n      tooltip: \"Override feature symbology\",\r\n    });\r\n\r\n    this.toolBar.addDropDown({\r\n      iconUnicode: \"\\ue923\", // \"pencil\"  ###TODO where to get real icon?\r\n      createDropDown: async (container: HTMLElement) => {\r\n        const panel = new RealityModelSettingsPanel(this.viewport, container);\r\n        await panel.populate();\r\n        return panel;\r\n      },\r\n      tooltip: \"Point cloud settings\",\r\n    });\r\n\r\n    this.updateTitle();\r\n    this.updateActiveSettings();\r\n  }\r\n\r\n  private updateTitle(): void {\r\n    let viewName = this.viewport.view.code.value;\r\n    if (undefined === viewName || 0 === viewName.length)\r\n      viewName = \"UNNAMED\";\r\n\r\n    const id = !this._isSavedView ? this.viewport.view.id : \"Saved View\";\r\n    const dim = this.viewport.view.is2d() ? \"2d\" : \"3d\";\r\n    this.title = `[ ${this.viewport.viewportId} ] ${viewName} <${id}> (${dim})`;\r\n  }\r\n\r\n  private updateActiveSettings(): void {\r\n    // NOTE: First category/model is fine for testing purposes...\r\n    const view = this.viewport.view;\r\n    if (!view.iModel.isBriefcaseConnection())\r\n      return;\r\n\r\n    const settings = view.iModel.editorToolSettings;\r\n    if (undefined === settings.category || !view.viewsCategory(settings.category)) {\r\n      settings.category = undefined;\r\n      for (const catId of view.categorySelector.categories) {\r\n        settings.category = catId;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (undefined === settings.model || !view.viewsModel(settings.model)) {\r\n      settings.model = undefined;\r\n      if (view.is2d()) {\r\n        settings.model = view.baseModelId;\r\n      } else if (view.isSpatialView()) {\r\n        settings.model = undefined;\r\n        for (const modId of view.modelSelector.models) {\r\n          settings.model = modId;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private async changeView(id: Id64String): Promise<void> {\r\n    const view = await this.views.getView(id, this._imodel);\r\n    await this.setView(view.clone());\r\n    for (const control of this._3dOnly)\r\n      control.style.display = this.viewport.view.is3d() ? \"block\" : \"none\";\r\n  }\r\n\r\n  public async setView(view: ViewState, isSavedView = false): Promise<void> {\r\n    this._isSavedView = isSavedView;\r\n    this.viewport.changeView(view);\r\n    this._maybeDisableEdges();\r\n    this.updateTitle();\r\n    this.updateActiveSettings();\r\n    await this.toolBar.onViewChanged(this.viewport);\r\n  }\r\n\r\n  public async applySavedView(view: ViewState): Promise<void> {\r\n    return this.setView(view, true);\r\n  }\r\n\r\n  private async openView(view: ViewState): Promise<void> {\r\n    await this.setView(view);\r\n    IModelApp.viewManager.addViewport(this.viewport);\r\n  }\r\n\r\n  private async clearViews(): Promise<void> {\r\n    await this.closeIModel();\r\n    this.views.clear();\r\n  }\r\n\r\n  private async buildViewList(): Promise<void> {\r\n    await this.views.populate(this._imodel);\r\n    this._viewPicker.populate(this.views);\r\n  }\r\n\r\n  private async resetIModel(props: OpenIModelProps): Promise<void> {\r\n    const { fileName, iModelId } = props;\r\n    let newIModel: IModelConnection;\r\n    const sameFile = (fileName !== undefined && fileName === this._imodel.key) || (iModelId !== undefined && iModelId === this._imodel.iModelId);\r\n    if (!sameFile) {\r\n      try {\r\n        newIModel = await openIModel({ ...props, writable: this.surface.openReadWrite });\r\n      } catch (err: any) {\r\n        alert(err.toString());\r\n        return;\r\n      }\r\n    }\r\n\r\n    Surface.instance.onResetIModel(this);\r\n    IModelApp.viewManager.dropViewport(this.viewport, false);\r\n\r\n    await this.clearViews();\r\n\r\n    if (sameFile)\r\n      newIModel = await openIModel({ ...props, writable: this.surface.openReadWrite });\r\n\r\n    this._imodel = newIModel!;\r\n    await this.buildViewList();\r\n    const view = await this.views.getDefaultView(this._imodel);\r\n    await this.openView(view);\r\n  }\r\n\r\n  public async openFile(fileName?: string): Promise<void> {\r\n    return undefined !== fileName ? this.openIModel({ fileName, writable: this.surface.openReadWrite }) : this.selectIModel();\r\n  }\r\n\r\n  private async selectIModel(): Promise<void> {\r\n    const fileName = await this.surface.selectFileName();\r\n    return undefined !== fileName ? this.openIModel({ fileName, writable: this.surface.openReadWrite }) : Promise.resolve();\r\n  }\r\n\r\n  private async openIModel(props: OpenIModelProps): Promise<void> {\r\n    try {\r\n      await this.resetIModel(props);\r\n      setTitle(this._imodel);\r\n    } catch {\r\n      alert(\"Error - could not open file.\");\r\n    }\r\n  }\r\n\r\n  private async closeIModel(): Promise<void> {\r\n    return this._imodel.close();\r\n  }\r\n\r\n  public override onFocus(): void {\r\n    this._header.element.classList.add(\"viewport-header-focused\");\r\n    void IModelApp.viewManager.setSelectedView(this.viewport);\r\n  }\r\n\r\n  public override onLoseFocus(): void {\r\n    this._header.element.classList.remove(\"viewport-header-focused\");\r\n  }\r\n\r\n  public onSelected(): void {\r\n    this._header.element.classList.add(\"viewport-header-selected\");\r\n    this.container.classList.add(\"viewport-selected\");\r\n  }\r\n\r\n  public onDeselected(): void {\r\n    this._header.element.classList.remove(\"viewport-header-selected\");\r\n    this.container.classList.remove(\"viewport-selected\");\r\n  }\r\n\r\n  public get windowId(): string { return this.viewport.viewportId.toString(); }\r\n\r\n  public override onClosing(): void {\r\n    this.toolBar.dispose();\r\n    if (this._debugWindow) {\r\n      this._debugWindow.dispose();\r\n      this._debugWindow = undefined;\r\n    }\r\n\r\n    IModelApp.viewManager.dropViewport(this.viewport, true);\r\n  }\r\n\r\n  public override onClosed(): void {\r\n    if (undefined === IModelApp.viewManager.selectedView) {\r\n      IModelApp.notifications.outputMessage(new NotifyMessageDetails(OutputMessagePriority.Info, \"Closing iModel...\"));\r\n\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.closeIModel().then(() => IModelApp.notifications.outputMessage(new NotifyMessageDetails(OutputMessagePriority.Info, \"iModel closed.\")));\r\n    }\r\n  }\r\n\r\n  public toggleDebugWindow(): void {\r\n    if (!this._debugWindow)\r\n      this._debugWindow = new DebugWindow(this.viewport);\r\n\r\n    this._debugWindow.toggle();\r\n  }\r\n}\r\n"
        ],
        "mappings": "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",
        "names": []
      }
    }
  ]
}
