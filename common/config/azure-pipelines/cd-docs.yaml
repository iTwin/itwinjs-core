# trigger:
#   branches:
#     include:
#       - master
#       - release/*
#     exclude:
#       - release/2*
#       - release/1*

trigger: none
pr: none

# Octopus requires release be of format 'x.y.z' or 'w.x.y.z'
name: $(Year:yyyy).$(Month).$(DayOfMonth).$(Rev:r)

# Pull in artifacts

resources:
  pipelines:
  - pipeline: itwinjs-docs
    source: iTwin.js Docs - YAML
    version: 20221017.30
    # trigger:
    #   branches:
    #     include:
    #     - master
    #     - release/*
    #     - docs-release-pipeline
    #     exclude:
    #     - release/2*
    #     - release/1*
    #   tags:
    #   - iTwinJsDocsRelease
  - pipeline: bemetalsmith-tests
    source: Bemetalsmith - Selenium Testss

variables:
  octopusProjectName: iModel.js Documentation

stages:
  - stage: CreateRelease
    displayName: Create release
    jobs:
    - template: ./jobs/docs/package-docs.yaml

  - stage: DEV
    displayName: Deployment (DEV)
    dependsOn: CreateRelease
    jobs:
    - template: ./jobs/docs/deploy-docs.yaml
      parameters:
        env: Development

  - stage: ProductTestsDEV
    displayName: Product Tests (DEV)
    dependsOn: DEV
    jobs:
    - template: ./jobs/docs/product-tests.yaml
      parameters:
        env: Development

  # - stage: QA
  #   displayName: Deployment (QA)
  #   dependsOn: ProductTestsDEV
  #   jobs:

  # - stage: ProductTestsQA
  #   displayName: Product Tests (QA)
  #   dependsOn: QA
  #   jobs:

  # - stage: LinkValidatorQA
  #   displayName: Link Validator (QA)
  #   dependsOn: QA
  #   jobs:

  # - stage: UpdateDocumentationIndexQA
  #   displayName: Update Documentation Index (QA)
  #   dependsOn: QA
  #   jobs:

  # - stage: ActiveScanQA
  #   displayName: Active Scan (QA)
  #   dependsOn: ProductTestsQA
  #   jobs:

  # - stage: Scorecard
  #   displayName: Scorecard
  #   dependsOn:
  #     - LinkValidatorQA
  #     - ProductTestsQA
  #   jobs:

  # - stage: PROD
  #   displayName: Deployment (PROD)
  #   dependsOn: Scorecard
  #   jobs:

  # - stage: UpdateDocumentationIndexPROD
  #   displayName: Update Documentation Index (PROD)
  #   dependsOn: PROD
  #   jobs: